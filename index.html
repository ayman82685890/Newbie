<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newbie Coin Bot</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #1a2a6c; /* Dark Blue */
            --secondary-color: #b21f1f; /* Deep Red */
            --accent-color: #fdbb2d; /* Gold/Yellow */
            --bg-dark: rgba(0, 0, 0, 0.85);
            --bg-light: rgba(255, 255, 255, 0.1);
            --shadow-dark: 0 5px 20px rgba(0, 0, 0, 0.7);
            
            /* Trading Page Colors */
            --trade-bg-dark: #0f172a;
            --trade-bg-medium: #1e293b;
            --trade-border-color: #334155;
            --trade-text-light: #e2e8f0;
            --trade-text-muted: #94a3b8;
            --trade-buy-color: #10b981; /* Green */
            --trade-sell-color: #ef4444; /* Red */
            --trade-accent-blue: #60a5fa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color), var(--accent-color));
            color: white;
            min-height: 100vh;
            padding-bottom: 80px; /* Space for the bottom menu */
            position: relative;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            background: var(--bg-dark);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow-dark);
            min-height: calc(100vh - 40px);
            display: flex;
            flex-direction: column;
        }

        header {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.6);
            border-bottom: 2px solid var(--accent-color);
        }

        .logo {
            font-size: 2.8rem;
            margin-bottom: 5px;
            text-shadow: 0 0 10px var(--accent-color);
        }

        h1 {
            font-size: 1.6rem;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .subtitle {
            color: var(--accent-color);
            font-size: 0.9rem;
            font-weight: 300;
        }

        .content {
            padding: 20px;
            flex-grow: 1;
        }
        
        /* New: Trade section content padding adjustment */
        .content.trade-active {
            padding: 0; /* Remove padding for the trade page to use full width */
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* Bottom Menu Navigation */
        .menu {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            background: var(--bg-dark);
            border-top: 1px solid var(--accent-color);
            z-index: 100;
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.5);
        }
        
        @media (min-width: 500px) {
            .menu {
                border-radius: 0 0 20px 20px;
                left: unset;
                right: unset;
            }
        }

        .menu-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 8px 10px;
            border-radius: 10px;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
            font-size: 0.75rem;
            font-weight: 600;
            opacity: 0.7;
            text-decoration: none;
        }
        
        .menu-btn i {
            font-size: 1.5rem;
        }

        .menu-btn.active {
            color: var(--accent-color);
            background: rgba(253, 187, 45, 0.1);
            transform: translateY(-2px);
            opacity: 1;
        }

        .menu-btn:hover:not(.active) {
            background: var(--bg-light);
            opacity: 0.9;
        }

        /* Shared Section Styles */
        .section-header-bg {
            height: 150px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-dark);
        }

        .section-header-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 15px;
            z-index: 0;
        }

        .section-content {
            position: relative;
            z-index: 1;
            text-align: center;
        }

        .section-content h2 {
            font-size: 1.5rem;
            color: var(--accent-color);
            margin-bottom: 5px;
        }

        /* Home Section */
        .home-bg {
            background: url('https://cdn.pixabay.com/photo/2016/08/24/14/29/planet-1617081_1280.jpg') center/cover;
            height: 250px;
        }

        .coin {
            width: 150px;
            height: 150px;
            background: radial-gradient(circle at 30% 30%, var(--accent-color), var(--secondary-color));
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2.5rem;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 0 30px var(--accent-color);
            animation: pulse 2s infinite;
            transition: transform 0.3s;
            border: 5px solid rgba(255, 255, 255, 0.2);
        }

        .coin:active {
            transform: scale(0.95);
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 20px var(--accent-color); }
            50% { box-shadow: 0 0 40px var(--accent-color); }
            100% { box-shadow: 0 0 20px var(--accent-color); }
        }

        .tap-btn {
            background: linear-gradient(to right, var(--accent-color), var(--secondary-color));
            border: none;
            color: var(--primary-color);
            font-weight: 700;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            width: 100%;
            margin: 15px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            transition: all 0.3s;
        }
        
        .tap-btn:disabled {
            background: #555;
            color: #ccc;
            cursor: not-allowed;
        }

        .tap-btn:active:not(:disabled) {
            transform: translateY(3px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .timer {
            text-align: center;
            background: var(--bg-light);
            padding: 12px;
            border-radius: 10px;
            margin: 10px 0;
            font-size: 1.1rem;
            font-weight: 600;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Earn Section (GigaPub) */
        .earn-bg {
            background: url('https://cdn.pixabay.com/photo/2016/11/15/07/09/photo-manipulation-1825450_1280.jpg') center/cover;
        }

        .ad-btn {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            border: none;
            color: white;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            width: 100%;
            margin: 15px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
        }

        .ad-btn:active:not(:disabled) {
            transform: translateY(3px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .ad-btn:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .limits {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 5px;
            margin: 15px 0;
            background: var(--bg-light);
            padding: 15px 5px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 400;
        }
        
        .limits div {
            text-align: center;
            padding: 0 5px;
            flex: 1;
            box-shadow: 1px 0 0 0 rgba(255, 255, 255, 0.2) inset;
        }
        
        .limits div:first-child {
            box-shadow: none;
        }

        /* Task Section */
        .task-bg {
            background: url('https://cdn.pixabay.com/photo/2017/08/30/07/56/notice-board-2696240_1280.jpg') center/cover;
        }

        .task-list {
            margin-top: 20px;
        }

        .task-item {
            background: var(--bg-light);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s;
        }
        
        .task-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
        }

        .task-btn {
            background: var(--primary-color);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
            text-decoration: none;
            display: inline-block;
        }
        
        .task-btn.completed {
            background: #4CAF50;
            cursor: default;
        }
        
        .task-btn:hover:not(.completed) {
            background: #0e1e55;
        }

        /* Profile Section */
        .profile-bg {
            background: url('https://cdn.pixabay.com/photo/2017/09/07/08/54/money-2724241_1280.jpg') center/cover;
        }

        .balance {
            background: var(--bg-light);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .balance h3 {
            font-weight: 400;
            color: #ccc;
        }

        .balance-amount {
            font-size: 2.5rem;
            margin: 10px 0;
            color: var(--accent-color);
            font-weight: 700;
        }

        .usd-info {
            font-size: 0.9rem;
            color: #aaa;
            margin-top: 5px;
            font-weight: 300;
        }

        .withdraw-btn {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            border: none;
            color: white;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            width: 100%;
            margin: 15px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
        }
        
        .withdraw-btn:active:not(:disabled) {
            transform: translateY(3px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px;
            border-radius: 10px;
            box-shadow: var(--shadow-dark);
            display: none;
            z-index: 1000;
            border-left: 5px solid var(--accent-color);
            font-weight: 600;
        }

        .notification.show {
            display: block;
            animation: fadeInOut 3s ease-in-out;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(-20px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-20px); }
        }

        .coin-pop {
            position: absolute;
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-color);
            text-shadow: 0 0 10px var(--accent-color);
            animation: popUp 1s ease-out forwards;
            pointer-events: none;
        }

        @keyframes popUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-80px) scale(1.8); opacity: 0; }
        }
        
        /* ------------------------------------------- */
        /* Trading Page Styles - Integrated and Adjusted */
        /* ------------------------------------------- */

        .trade-container {
            max-width: 500px;
            background: var(--trade-bg-dark);
            color: var(--trade-text-light);
            min-height: calc(100vh - 80px); /* Adjust height for menu */
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
        }

        .trade-header {
            background: var(--trade-bg-medium);
            padding: 15px 20px;
            border-bottom: 1px solid var(--trade-border-color);
        }

        .current-price {
            font-size: 2.2rem; /* Adjusted for smaller screens */
            font-weight: bold;
            text-align: center;
            margin-bottom: 5px;
            color: var(--trade-buy-color); /* Initial color */
        }

        .price-usd {
            text-align: center;
            color: var(--trade-text-muted);
            margin-bottom: 10px;
        }

        .price-change {
            text-align: center;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-label {
            color: var(--trade-text-muted);
            font-size: 0.8rem;
            margin-bottom: 3px;
        }

        .stat-value {
            font-weight: bold;
            font-size: 0.9rem;
        }

        /* Timeframe Tabs */
        .timeframe-tabs {
            display: flex;
            background: var(--trade-bg-medium);
            padding: 10px 20px;
            gap: 10px;
            overflow-x: auto;
            border-bottom: 1px solid var(--trade-border-color);
        }

        .timeframe-tab {
            padding: 6px 10px;
            border-radius: 12px;
            background: var(--trade-border-color);
            font-size: 0.8rem;
            cursor: pointer;
            flex-shrink: 0;
        }

        .timeframe-tab.active {
            background: var(--trade-accent-blue);
            color: white;
        }

        /* Chart Container (Simplified for Demo) */
        .chart-container {
            height: 200px;
            background: var(--trade-bg-dark);
            border-bottom: 1px solid var(--trade-border-color);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            color: var(--trade-text-muted);
        }
        
        .candlestick-chart {
            display: none; /* Hide real chart for now */
        }
        
        /* Main Content Grid */
        .main-content {
            display: grid;
            grid-template-columns: 1fr; /* Stack on mobile */
            gap: 0;
            min-height: 400px;
            flex-grow: 1;
        }
        
        @media (min-width: 400px) {
            .main-content {
                grid-template-columns: 1fr 1fr; /* Split on larger screens */
            }
        }

        /* Order Book & Trade History */
        .order-section {
            background: var(--trade-bg-medium);
            padding: 15px;
            border-bottom: 1px solid var(--trade-border-color); /* Divider for mobile */
        }
        
        @media (min-width: 400px) {
            .order-section:first-child {
                border-right: 1px solid var(--trade-border-color); /* Right divider for split screen */
                border-bottom: none;
            }
        }

        .section-title {
            color: var(--trade-text-muted);
            font-size: 0.9rem;
            margin-bottom: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .order-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 0.85rem;
        }

        .order-price {
            font-weight: bold;
        }

        .order-bid .order-price {
            color: var(--trade-buy-color);
        }

        .order-ask .order-price {
            color: var(--trade-sell-color);
        }
        
        .trade-history {
             margin-top: 15px;
        }

        .history-row {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 0.85rem;
        }
        
        .history-time {
            color: var(--trade-text-muted);
            font-size: 0.75rem;
        }

        .history-buy {
            color: var(--trade-buy-color);
            font-weight: 600;
        }

        .history-sell {
            color: var(--trade-sell-color);
            font-weight: 600;
        }

        /* Trading Interface */
        .trading-interface-box {
             padding: 15px;
        }

        .balance-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 0.85rem;
            color: var(--trade-text-muted);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--trade-text-muted);
            font-weight: 400;
            font-size: 0.85rem;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            background: #334155;
            border: 1px solid #475569;
            border-radius: 6px;
            color: white;
            font-size: 1rem;
        }

        .trade-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-trade {
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-buy {
            background: linear-gradient(135deg, var(--trade-buy-color), #059669);
            color: white;
        }

        .btn-sell {
            background: linear-gradient(135deg, var(--trade-sell-color), #dc2626);
            color: white;
        }
        
        .btn-trade:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Trading Panel (Hidden - replaced by menu) */
        .trading-panel {
            display: none; 
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <script data-project-id="3409">
        !function(){
            var s=document.currentScript,p=s.getAttribute('data-project-id')||'default';
            var d=['https://ad.gigapub.tech','https://ru-ad.gigapub.tech'],i=0,t,sc;
            function l(){
                sc=document.createElement('script');
                sc.async=true;
                sc.src=d[i]+'/script?id='+p;
                clearTimeout(t);
                t=setTimeout(function(){
                    sc.onload=sc.onerror=null;
                    sc.src='';
                    if(++i<d.length)l();
                },15000);
                sc.onload=function(){clearTimeout(t)};
                sc.onerror=function(){clearTimeout(t);if(++i<d.length)l()};
                document.head.appendChild(sc);
            }
            l();
        }();
    </script>
</head>
<body>
    <div class="container" id="appContainer">
        <header id="mainHeader">
            <div class="logo">⭐</div>
            <h1>Newbie Coin Bot</h1>
            <p class="subtitle">Tap, Earn, and Trade NBT tokens!</p>
        </header>

        <div class="content" id="mainContent">
            <div class="section active" id="home">
                <div class="section-header-bg home-bg">
                    <div class="coin" id="tap-coin">NBT</div>
                </div>
                <button class="tap-btn" id="tap-btn">Tap to Get Coins</button>
                <div class="timer" id="timer">
                    Next tap available in: <span id="countdown">24:00:00</span>
                </div>
            </div>

            <div class="section" id="earn">
                <div class="section-header-bg earn-bg">
                    <div class="section-content">
                        <h2>Watch & Earn</h2>
                        <p>Watch a short ad to earn <span id="ad-reward-amount">1</span> NBT token!</p>
                    </div>
                </div>
                <div class="limits">
                    <div>Daily Ads: <span id="daily-ads">0</span>/60</div>
                    <div>Hourly Ads: <span id="hourly-ads">0</span>/20</div>
                    <div>Ad Cooldown: <span id="ad-cooldown-display">Ready</span></div>
                </div>
                <button class="ad-btn" id="watch-ad">Watch Ad</button>
            </div>

            <div class="section" id="task">
                <div class="section-header-bg task-bg">
                    <div class="section-content">
                        <h2>🚀 Complete Tasks</h2>
                        <p>Complete social media tasks for easy NBT!</p>
                    </div>
                </div>
                <div class="task-list" id="task-list">
                    </div>
            </div>

            <div class="section" id="trade">
                <div class="trade-container">
                    <div class="trade-header">
                        <div class="current-price" id="currentPrice">0.000013</div>
                        <div class="price-usd">≈$<span id="priceUSD">0.000013</span></div>
                        <div class="price-change" id="priceChange">+0.00%</div>
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-label">24h High</div>
                                <div class="stat-value" id="high24h">0.000015</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">24h Low</div>
                                <div class="stat-value" id="low24h">0.000011</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">24h Vol (NBT)</div>
                                <div class="stat-value" id="volume24h">1.2M</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">24h Turnover (USDT)</div>
                                <div class="stat-value" id="turnover24h">15.6</div>
                            </div>
                        </div>
                    </div>

                    <div class="timeframe-tabs">
                        <div class="timeframe-tab">1m</div>
                        <div class="timeframe-tab">15m</div>
                        <div class="timeframe-tab active">1h</div>
                        <div class="timeframe-tab">4h</div>
                        <div class="timeframe-tab">1D</div>
                        <div class="timeframe-tab">3M</div>
                    </div>

                    <div class="chart-container">
                        <p>Loading NBT/USDT Chart...</p>
                    </div>

                    <div class="main-content">
                        <div class="order-section">
                            <div class="section-title">Order Book (Simulated)</div>
                            <div id="orderBook">
                                </div>
                            
                            <div class="section-title trade-history-title" style="margin-top: 15px;">Trade History (Simulated)</div>
                            <div id="tradeHistory">
                                </div>
                        </div>

                        <div class="order-section">
                            <div class="section-title">Place Order</div>
                            <div class="trading-interface-box">
                                <div class="balance-info">
                                    <span>NBT Balance:</span>
                                    <span id="tradeNBTBalance">0.00 NBT</span>
                                </div>
                                <div class="balance-info">
                                    <span>USDT Balance:</span>
                                    <span id="tradeUSDTBalance">0.00 USDT</span>
                                </div>
                                
                                <div class="form-group">
                                    <label for="orderAmount">Amount (NBT)</label>
                                    <input type="number" id="orderAmount" placeholder="Min 10 NBT" min="10" step="1">
                                </div>

                                <div class="form-group">
                                    <label>Price: <span id="currentPriceInput">0.000013</span> USDT</label>
                                </div>
                                
                                <div class="form-group">
                                    <label>Total Cost/Revenue: <span id="orderTotal">0.00</span> USDT</label>
                                </div>

                                <div class="trade-buttons">
                                    <button class="btn-trade btn-buy" id="btnBuy" onclick="placeOrder('buy')">BUY NBT</button>
                                    <button class="btn-trade btn-sell" id="btnSell" onclick="placeOrder('sell')">SELL NBT</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section" id="profile">
                <div class="section-header-bg profile-bg">
                    <div class="section-content">
                        <h2>💰 Your Wallet</h2>
                        <p>Manage your NBT tokens and future earnings.</p>
                    </div>
                </div>
                <div class="balance">
                    <h3>Your Balance</h3>
                    <div class="balance-amount" id="nbt-balance">0 NBT</div>
                    <div class="usd-info">Future USDT Value (Estimate): <span id="usd-balance">$0.00</span></div>
                    <div class="balance-amount" id="usdt-balance">0.00 USDT</div>
                    <div class="usd-info">Your **USDT** will be available here after the **Trade** feature launches!</div>
                </div>
                <button class="withdraw-btn" id="withdraw-btn">Withdraw NBT/USDT</button>
            </div>
        </div>
        
        <div class="menu">
            <button class="menu-btn active" data-section="home"><i class="fas fa-home"></i>Home</button>
            <button class="menu-btn" data-section="earn"><i class="fas fa-video"></i>Earn</button>
            <button class="menu-btn" data-section="task"><i class="fas fa-clipboard-list"></i>Tasks</button>
            <button class="menu-btn" data-section="trade"><i class="fas fa-chart-line"></i>Trade</button>
            <button class="menu-btn" data-section="profile"><i class="fas fa-user-circle"></i>Profile</button>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // Global variables and constants (Main App)
        let nbtBalance = 0;
        let usdtBalance = 1000.00; // Starting at 1000 USDT for trade demo
        let dailyAdsWatched = 0;
        let adsWatchedThisHour = 0; 
        let lastAdHourResetTime = 0; 
        let lastTapTime = 0;
        let adCooldown = false;
        
        const HOUR_IN_MS = 60 * 60 * 1000; 
        const TAP_REWARD = 20;
        const AD_REWARD = 1;
        const TASK_REWARD = 3;
        const AD_COOLDOWN_SECONDS = 10;
        const DAILY_AD_LIMIT = 60;
        const HOURLY_AD_LIMIT = 20;
        const NBT_USD_RATE = 1 / 1000; // For profile display
        
        const STORAGE_KEY = 'newbieCoinBotData';

        const TASKS = [
            { id: 1, name: "Join Telegram Channel 1", link: "https://t.me/NEWBIE540", status: "pending" },
            { id: 2, name: "Join Telegram Channel 2", link: "https://t.me/NewbieBXD", status: "pending" },
            { id: 3, name: "Join Telegram Group 1 (Community)", link: "https://t.me/NEWBIECOMMUNIT", status: "pending" },
            { id: 4, name: "Join Telegram Group 2", link: "https://t.me/NWEBIE67", status: "pending" },
            { id: 5, name: "Follow on Twitter", link: "https://twitter.com/newbiecoin_placeholder", status: "pending" }
        ];
        
        let savedTaskStatuses = []; 


        // DOM elements (Main App)
        const appContainer = document.getElementById('appContainer');
        const mainHeader = document.getElementById('mainHeader');
        const mainContent = document.getElementById('mainContent');
        const menuBtns = document.querySelectorAll('.menu-btn');
        const sections = document.querySelectorAll('.section');
        const tapBtn = document.getElementById('tap-btn');
        const tapCoin = document.getElementById('tap-coin');
        const countdownEl = document.getElementById('countdown');
        const watchAdBtn = document.getElementById('watch-ad');
        const dailyAdsEl = document.getElementById('daily-ads');
        const hourlyAdsEl = document.getElementById('hourly-ads');
        const adCooldownDisplayEl = document.getElementById('ad-cooldown-display');
        const nbtBalanceEl = document.getElementById('nbt-balance');
        const usdBalanceEl = document.getElementById('usd-balance');
        const usdtBalanceEl = document.getElementById('usdt-balance');
        const withdrawBtn = document.getElementById('withdraw-btn');
        const notificationEl = document.getElementById('notification');
        const taskListEl = document.getElementById('task-list');

        // --- Persistence Functions ---

        function saveData() {
            const data = {
                nbtBalance: nbtBalance,
                usdtBalance: usdtBalance,
                dailyAdsWatched: dailyAdsWatched,
                adsWatchedThisHour: adsWatchedThisHour,
                lastAdHourResetTime: lastAdHourResetTime,
                lastTapTime: lastTapTime,
                adCooldown: adCooldown,
                tasks: TASKS.map(t => ({ id: t.id, status: t.status })),
                // Trade State Persistence
                tradeState: {
                    currentPrice: tradeState.currentPrice,
                    orders: tradeState.orders,
                    tradeHistory: tradeState.tradeHistory,
                }
            };
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            } catch (e) {
                console.error("Error saving data to localStorage:", e);
            }
        }

        function loadData() {
            try {
                const savedData = localStorage.getItem(STORAGE_KEY);
                if (savedData) {
                    const data = JSON.parse(savedData);
                    
                    nbtBalance = data.nbtBalance || 0;
                    usdtBalance = data.usdtBalance !== undefined ? data.usdtBalance : 1000.00; // Use default if undefined
                    dailyAdsWatched = data.dailyAdsWatched || 0;
                    adsWatchedThisHour = data.adsWatchedThisHour || 0;
                    lastAdHourResetTime = data.lastAdHourResetTime || 0;
                    lastTapTime = data.lastTapTime || 0;
                    adCooldown = data.adCooldown || false;

                    if (data.tasks && Array.isArray(data.tasks)) {
                       savedTaskStatuses = data.tasks;
                    }
                    
                    // Load Trade State
                    if (data.tradeState) {
                        tradeState.currentPrice = data.tradeState.currentPrice || tradeState.currentPrice;
                        tradeState.orders = data.tradeState.orders || tradeState.orders;
                        tradeState.tradeHistory = data.tradeState.tradeHistory || tradeState.tradeHistory;
                    }

                    return true;
                }
            } catch (e) {
                console.error("Error loading data from localStorage:", e);
                return false;
            }
            return false;
        }
        
        function applyTaskStatuses() {
            if (savedTaskStatuses.length > 0) {
                savedTaskStatuses.forEach(savedTask => {
                    const localTask = TASKS.find(t => t.id === savedTask.id);
                    if (localTask) {
                        localTask.status = savedTask.status;
                    }
                });
            }
        }

        // --- Core Functions (Main App) ---

        // Menu navigation
        menuBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const sectionId = btn.getAttribute('data-section');
                
                menuBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                sections.forEach(section => {
                    section.classList.remove('active');
                    if (section.id === sectionId) {
                        section.classList.add('active');
                    }
                });
                
                // Toggle header visibility and content padding
                if (sectionId === 'trade') {
                    mainHeader.style.display = 'none';
                    mainContent.classList.add('trade-active');
                    updateTradeDisplay(); // Update trade screen when navigating to it
                } else {
                    mainHeader.style.display = 'block';
                    mainContent.classList.remove('trade-active');
                    if (sectionId === 'earn') {
                        updateEarnSectionDisplay();
                    }
                }
            });
        });

        // Update Balances (General)
        function updateBalance() {
            nbtBalanceEl.textContent = `${nbtBalance.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0})} NBT`;
            usdBalanceEl.textContent = `$${(nbtBalance * NBT_USD_RATE).toFixed(4)}`; // Use 4 decimal places for better visibility
            usdtBalanceEl.textContent = `${usdtBalance.toFixed(2)} USDT`;
        }
        
        // Notification system
        function showNotification(message) {
            notificationEl.textContent = message;
            notificationEl.classList.add('show');
            
            setTimeout(() => {
                notificationEl.classList.remove('show');
            }, 3000);
        }

        // ... (Home, Earn, Task, Profile functions remain the same) ...
        
        // --- Home Section (Tap to Earn) ---
        
        tapBtn.addEventListener('click', handleTap);
        tapCoin.addEventListener('click', handleTap);

        function handleTap() {
            const fullCooldown = 24 * 60 * 60 * 1000;
            const timePassed = Date.now() - lastTapTime;
            if (timePassed < fullCooldown) return;

            nbtBalance += TAP_REWARD;
            updateBalance();
            
            showNotification(`${TAP_REWARD} NBT added! See you in 24 hours!`);
            createCoinPop(TAP_REWARD);
            
            lastTapTime = Date.now();
            saveData(); 
            
            updateTapTimer();
        }

        function createCoinPop(amount) {
            const pop = document.createElement('div');
            pop.className = 'coin-pop';
            pop.textContent = `+${amount}`;
            pop.style.top = '30%'; 
            pop.style.left = `${Math.random() * 20 + 40}%`;
            document.querySelector('.home-bg').appendChild(pop);
            
            setTimeout(() => {
                pop.remove();
            }, 1000);
        }

        function updateTapTimer() {
            const now = Date.now();
            const fullCooldown = 24 * 60 * 60 * 1000;
            const timePassed = now - lastTapTime;
            const timeRemaining = fullCooldown - timePassed;
            
            if (timeRemaining <= 0) {
                tapBtn.disabled = false;
                countdownEl.textContent = "00:00:00";
                tapBtn.textContent = "Tap to Get Coins";
                return;
            }
            
            tapBtn.disabled = true;
            tapBtn.textContent = "On Cooldown";
            
            const hours = Math.floor(timeRemaining / (1000 * 60 * 60));
            const minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);
            
            countdownEl.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            setTimeout(updateTapTimer, 1000);
        }
        
        // --- Earn Section (GigaPub Ad) ---
        
        watchAdBtn.addEventListener('click', handleAdWatch);
        
        function checkAdLimits() {
            const now = Date.now();
            if (now - lastAdHourResetTime >= HOUR_IN_MS) {
                adsWatchedThisHour = 0;
                lastAdHourResetTime = now;
                saveData(); 
            }
        }
        
        function updateEarnSectionDisplay() {
            updateBalance(); 
            checkAdLimits();

            dailyAdsEl.textContent = `${dailyAdsWatched}/${DAILY_AD_LIMIT}`;
            hourlyAdsEl.textContent = `${adsWatchedThisHour}/${HOURLY_AD_LIMIT}`;

            let buttonText = "Watch Ad";
            let isDisabled = adCooldown;
            
            if (dailyAdsWatched >= DAILY_AD_LIMIT) {
                isDisabled = true;
                buttonText = `Daily Limit Reached (${DAILY_AD_LIMIT})`;
            } else if (adsWatchedThisHour >= HOURLY_AD_LIMIT) {
                isDisabled = true;
                buttonText = `Hourly Limit Reached (${HOURLY_AD_LIMIT})`;
            } else if (adCooldown) {
                 buttonText = watchAdBtn.textContent; 
            }

            watchAdBtn.disabled = isDisabled;
            if (!adCooldown || isDisabled) {
                watchAdBtn.textContent = buttonText;
            }
        }

        function handleAdWatch() {
            checkAdLimits(); 
            if (adCooldown || dailyAdsWatched >= DAILY_AD_LIMIT || adsWatchedThisHour >= HOURLY_AD_LIMIT) {
                updateEarnSectionDisplay(); 
                return;
            }
            
            adCooldown = true;
            watchAdBtn.disabled = true;
            watchAdBtn.textContent = "Loading Ad...";

            if (window.showGiga) {
                window.showGiga()
                    .then(() => {
                        nbtBalance += AD_REWARD;
                        dailyAdsWatched++;
                        adsWatchedThisHour++;
                        updateEarnSectionDisplay();
                        showNotification(`You earned ${AD_REWARD} NBT for watching the ad!`);
                        saveData(); 
                        startAdCooldown();
                    })
                    .catch(e => {
                        showNotification("Ad not completed. Please try again (Simulated Cooldown).");
                        startAdCooldown(); 
                        console.error("GigaPub Error:", e);
                    });
            } else {
                showNotification("Ad network unavailable. Simulating ad watch...");
                
                setTimeout(() => {
                    nbtBalance += AD_REWARD;
                    dailyAdsWatched++;
                    adsWatchedThisHour++;
                    updateEarnSectionDisplay();
                    showNotification(`You earned ${AD_REWARD} NBT (Simulated)!`);
                    saveData();
                    startAdCooldown();
                }, 1000);
            }
        }
        
        function startAdCooldown(initialCooldown = AD_COOLDOWN_SECONDS) {
            adCooldown = true;
            watchAdBtn.disabled = true;
            
            let countdown = initialCooldown;
            
            if (watchAdBtn.dataset.timerId) {
                clearInterval(watchAdBtn.dataset.timerId);
            }

            const timer = setInterval(() => {
                countdown--;
                adCooldownDisplayEl.textContent = `${countdown}s`;
                watchAdBtn.textContent = `Cooldown: ${countdown}s`;
                
                if (countdown <= 0) {
                    clearInterval(timer);
                    delete watchAdBtn.dataset.timerId;
                    adCooldown = false;
                    adCooldownDisplayEl.textContent = 'Ready';
                    
                    updateEarnSectionDisplay();
                    saveData(); 
                }
            }, 1000);
            
            watchAdBtn.dataset.timerId = timer;
        }
        
        // --- Task Section ---
        
        function renderTasks() {
            taskListEl.innerHTML = '';
            TASKS.forEach(task => {
                const isCompleted = task.status === 'completed';
                const item = document.createElement('div');
                item.className = 'task-item';
                item.innerHTML = `
                    <div>
                        ${task.name} <i class="fab fa-telegram-plane" style="color:#0088cc;" title="Telegram Link"></i> <br>
                        <small style="color: #ccc;">Reward: ${TASK_REWARD} NBT</small>
                    </div>
                    <a href="${task.link}" target="_blank" onclick="handleTaskClick(event, ${task.id}, ${isCompleted})">
                        <span class="task-btn ${isCompleted ? 'completed' : ''}" 
                                data-task-id="${task.id}" style="${isCompleted ? 'pointer-events: none; cursor: default;' : ''}">
                            ${isCompleted ? 'Completed' : 'Go & Claim'}
                        </span>
                    </a>
                `;
                taskListEl.appendChild(item);
            });
        }
        
        function handleTaskClick(e, taskId, isCompleted) {
            if (isCompleted) {
                e.preventDefault();
                showNotification("You have already completed this task!");
                return;
            }
            
            const task = TASKS.find(t => t.id === taskId);
            
            if (task && task.status !== 'completed') {
                setTimeout(() => {
                    if (task.status !== 'completed') {
                        task.status = 'completed';
                        nbtBalance += TASK_REWARD;
                        updateBalance();
                        saveData(); 
                        showNotification(`Task "${task.name}" completed! ${TASK_REWARD} NBT added!`);
                        renderTasks(); 
                    }
                }, 1000); 
            }
        }
        
        window.handleTaskClick = handleTaskClick;

        // --- Profile Section ---
        
        withdrawBtn.addEventListener('click', () => {
            showNotification("The **Withdraw** feature, including NBT to USDT conversion, will be available after the Trade feature launch!");
        });


        // -------------------------------------------
        // 🚀 Trading Logic Integration (Part of original Trade JS)
        // -------------------------------------------
        
        const TRADE_START_PRICE = 0.000013;
        const MIN_TRADE_AMOUNT = 10;
        
        const tradeState = {
            currentPrice: TRADE_START_PRICE,
            lastPrice: TRADE_START_PRICE,
            priceHistory: [],
            orders: {
                bids: [
                    { price: TRADE_START_PRICE - 0.0000001, amount: 45231 },
                    { price: TRADE_START_PRICE - 0.0000002, amount: 28456 },
                    { price: TRADE_START_PRICE - 0.0000003, amount: 18900 }
                ],
                asks: [
                    { price: TRADE_START_PRICE + 0.0000001, amount: 32167 },
                    { price: TRADE_START_PRICE + 0.0000002, amount: 19873 },
                    { price: TRADE_START_PRICE + 0.0000003, amount: 12500 }
                ]
            },
            tradeHistory: [
                 { type: 'buy', amount: 50000, price: TRADE_START_PRICE, timestamp: new Date(Date.now() - 30000) },
                 { type: 'sell', amount: 30000, price: TRADE_START_PRICE + 0.0000001, timestamp: new Date(Date.now() - 15000) },
            ],
            volume: { buy: 0, sell: 0 },
            high24h: 0.000015,
            low24h: 0.000011,
            volume24h: 1200000, // 1.2M
            turnover24h: 15.6,
        };

        // DOM Elements (Trade)
        const tradeElements = {
            currentPrice: document.getElementById('currentPrice'),
            priceUSD: document.getElementById('priceUSD'),
            priceChange: document.getElementById('priceChange'),
            high24h: document.getElementById('high24h'),
            low24h: document.getElementById('low24h'),
            volume24h: document.getElementById('volume24h'),
            turnover24h: document.getElementById('turnover24h'),
            orderBook: document.getElementById('orderBook'),
            tradeHistory: document.getElementById('tradeHistory'),
            orderAmount: document.getElementById('orderAmount'),
            orderTotal: document.getElementById('orderTotal'),
            tradeNBTBalance: document.getElementById('tradeNBTBalance'),
            tradeUSDTBalance: document.getElementById('tradeUSDTBalance'),
            currentPriceInput: document.getElementById('currentPriceInput'),
            btnBuy: document.getElementById('btnBuy'),
            btnSell: document.getElementById('btnSell')
        };
        
        // Setup Trade Event Listeners
        tradeElements.orderAmount.addEventListener('input', updateOrderCalculation);

        // Update order calculation
        function updateOrderCalculation() {
            const amount = parseFloat(tradeElements.orderAmount.value) || 0;
            const total = amount * tradeState.currentPrice;
            tradeElements.orderTotal.textContent = total.toFixed(6);
            
            // Disable buttons if amount is too low
            const isDisabled = amount < MIN_TRADE_AMOUNT;
            tradeElements.btnBuy.disabled = isDisabled;
            tradeElements.btnSell.disabled = isDisabled;
        }

        // Place order
        function placeOrder(type) {
            const amount = Math.floor(parseFloat(tradeElements.orderAmount.value));
            
            if (amount < MIN_TRADE_AMOUNT) {
                showNotification(`Minimum trade amount is ${MIN_TRADE_AMOUNT} NBT.`);
                return;
            }

            const cost = amount * tradeState.currentPrice;
            
            if (type === 'buy') {
                if (cost > usdtBalance) {
                    showNotification('Insufficient USDT balance for this purchase!');
                    return;
                }

                usdtBalance -= cost;
                nbtBalance += amount;
                
                // Simulate order book activity
                tradeState.orders.bids.unshift({ price: tradeState.currentPrice, amount: amount });
                tradeState.orders.bids.sort((a, b) => b.price - a.price); // Sort descending
                tradeState.orders.bids = tradeState.orders.bids.slice(0, 5);

            } else { // Sell
                if (amount > nbtBalance) {
                    showNotification('Insufficient NBT balance to sell!');
                    return;
                }

                nbtBalance -= amount;
                usdtBalance += cost;
                
                // Simulate order book activity
                tradeState.orders.asks.unshift({ price: tradeState.currentPrice, amount: amount });
                tradeState.orders.asks.sort((a, b) => a.price - b.price); // Sort ascending
                tradeState.orders.asks = tradeState.orders.asks.slice(0, 5);
            }

            // Add to trade history (keep only 10)
            tradeState.tradeHistory.unshift({
                type: type,
                amount: amount,
                price: tradeState.currentPrice,
                timestamp: new Date()
            });
            tradeState.tradeHistory = tradeState.tradeHistory.slice(0, 10);
            
            // Update price based on trade (minimal impact for demo)
            tradeState.lastPrice = tradeState.currentPrice;
            const priceImpact = type === 'buy' ? 0.00000001 : -0.00000001; 
            tradeState.currentPrice = Math.max(TRADE_START_PRICE / 2, tradeState.currentPrice + priceImpact);
            
            // Reset input
            tradeElements.orderAmount.value = '';
            tradeElements.orderTotal.textContent = '0.00';
            
            // Update all displays and save data
            updateBalance();
            updateTradeDisplay();
            saveData();
            
            showNotification(`${type.toUpperCase()} ${amount} NBT successful! Total: ${cost.toFixed(6)} USDT`);
        }
        
        // Update Trade Display (Trade section specific)
        function updateTradeDisplay() {
            const priceChange = ((tradeState.currentPrice - tradeState.lastPrice) / tradeState.lastPrice) * 100;
            const priceColor = priceChange >= 0 ? 'var(--trade-buy-color)' : 'var(--trade-sell-color)';
            
            tradeElements.currentPrice.textContent = tradeState.currentPrice.toFixed(6);
            tradeElements.currentPrice.style.color = priceColor;
            tradeElements.priceUSD.textContent = (tradeState.currentPrice).toFixed(6);
            tradeElements.priceChange.textContent = `${priceChange >= 0 ? '+' : ''}${priceChange.toFixed(2)}%`;
            tradeElements.priceChange.style.color = priceColor;
            
            // Balances
            tradeElements.tradeNBTBalance.textContent = nbtBalance.toLocaleString(undefined, {minimumFractionDigits: 0, maximumFractionDigits: 0}) + ' NBT';
            tradeElements.tradeUSDTBalance.textContent = usdtBalance.toFixed(2) + ' USDT';
            tradeElements.currentPriceInput.textContent = tradeState.currentPrice.toFixed(6);

            // Simulated 24h stats
            tradeElements.high24h.textContent = tradeState.high24h.toFixed(6);
            tradeElements.low24h.textContent = tradeState.low24h.toFixed(6);
            tradeElements.volume24h.textContent = (tradeState.volume24h / 1000000).toFixed(1) + 'M';
            tradeElements.turnover24h.textContent = tradeState.turnover24h.toFixed(1);
            
            // Update Order Book
            updateOrderBook();

            // Update Trade History
            updateTradeHistory();
            
            updateOrderCalculation(); // Re-check button state
        }
        
        function updateOrderBook() {
            const ob = tradeElements.orderBook;
            ob.innerHTML = '';
            
            // Header for bids
            ob.innerHTML += `<div class="order-row" style="font-weight: 600; color: var(--trade-text-light);"><span>Amount (NBT)</span><span>Price (USDT)</span></div>`;

            // Asks (Sell Orders - Red, Price High to Low)
            tradeState.orders.asks.slice(0, 3).reverse().forEach(order => {
                ob.innerHTML += `
                    <div class="order-row order-ask">
                        <div class="order-amount">${order.amount.toLocaleString(undefined, { maximumFractionDigits: 0 })}</div>
                        <div class="order-price">${order.price.toFixed(6)}</div>
                    </div>
                `;
            });
            
            // Current Price Separator
             ob.innerHTML += `<div class="order-row" style="font-weight: bold; color: ${tradeElements.currentPrice.style.color}; margin: 5px 0; border: none;"><span>Current Price</span><span>${tradeState.currentPrice.toFixed(6)}</span></div>`;

            // Bids (Buy Orders - Green, Price High to Low)
            tradeState.orders.bids.slice(0, 3).forEach(order => {
                ob.innerHTML += `
                    <div class="order-row order-bid">
                        <div class="order-amount">${order.amount.toLocaleString(undefined, { maximumFractionDigits: 0 })}</div>
                        <div class="order-price">${order.price.toFixed(6)}</div>
                    </div>
                `;
            });
        }

        function updateTradeHistory() {
            const th = tradeElements.tradeHistory;
            th.innerHTML = '';
             th.innerHTML += `<div class="history-row" style="font-weight: 600; color: var(--trade-text-light); border-bottom: 1px solid var(--trade-border-color);"><span>Time</span><span>Price (USDT)</span><span>Amount (NBT)</span></div>`;
            
            tradeState.tradeHistory.slice(0, 5).forEach(trade => {
                const typeClass = trade.type === 'buy' ? 'history-buy' : 'history-sell';
                th.innerHTML += `
                    <div class="history-row">
                        <div class="history-time">${trade.timestamp.toLocaleTimeString()}</div>
                        <div class="history-price ${typeClass}">${trade.price.toFixed(6)}</div>
                        <div class="history-amount">${trade.amount.toLocaleString(undefined, { maximumFractionDigits: 0 })}</div>
                    </div>
                `;
            });
        }
        
        // Simulate market activity (small price drift over time)
        function simulateMarketActivity() {
            setInterval(() => {
                if (document.getElementById('trade').classList.contains('active')) {
                     // Add a very small random drift to the price
                    const drift = (Math.random() - 0.5) * 0.000000005;
                    tradeState.lastPrice = tradeState.currentPrice;
                    tradeState.currentPrice = Math.max(0.000001, tradeState.currentPrice + drift);
                    
                    // Keep the demo price around the start price
                    if (tradeState.currentPrice > TRADE_START_PRICE * 1.2) {
                         tradeState.currentPrice -= 0.00000001; // Pull down
                    } else if (tradeState.currentPrice < TRADE_START_PRICE * 0.8) {
                        tradeState.currentPrice += 0.00000001; // Pull up
                    }
                    
                    // Simulate minor order book and history updates
                    if (Math.random() > 0.6) {
                        tradeState.tradeHistory.unshift({
                            type: Math.random() > 0.5 ? 'buy' : 'sell',
                            amount: Math.floor(Math.random() * 5000 + 500),
                            price: tradeState.currentPrice,
                            timestamp: new Date()
                        });
                         tradeState.tradeHistory = tradeState.tradeHistory.slice(0, 10);
                    }
                    
                    updateTradeDisplay();
                    saveData();
                }
            }, 5000); // Update every 5 seconds
        }


        // --- Initialization ---

        function initialize() {
            const dataLoaded = loadData();
            
            if (dataLoaded) {
                applyTaskStatuses();
            } else {
                // If no data, ensure all state is the default fresh start
                nbtBalance = 0;
                usdtBalance = 1000.00;
                dailyAdsWatched = 0;
                adsWatchedThisHour = 0; 
                lastAdHourResetTime = 0; 
                lastTapTime = 0; 
                adCooldown = false;
                TASKS.forEach(task => task.status = 'pending');
                // Trade state remains default as defined globally if no saved data
            }

            checkAdLimits(); 
            updateEarnSectionDisplay(); 
            
            if (adCooldown) {
                startAdCooldown(AD_COOLDOWN_SECONDS);
            } else {
                 adCooldownDisplayEl.textContent = 'Ready';
            }
            
            updateTapTimer();
            renderTasks();
            updateBalance();
            
            // Initialize Trade Interface
            updateTradeDisplay();
            simulateMarketActivity();
        }
        
        initialize();
    </script>
</body>
</html>
